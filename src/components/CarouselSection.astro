---
import slide1 from '../assets/carousel1.jpg';
import slide2 from '../assets/carousel2.jpg';
import slide3 from '../assets/carousel3.jpg';

const slides = [
	{ src: slide1.src, alt: 'Boîte à livres en cabine vitrée', title: 'Cabine lumineuse', desc: 'Installée en centre-ville avec éclairage intégré.' },
	{ src: slide2.src, alt: 'Boîte à livres colorée en plein air', title: 'Couleurs vives', desc: 'Un modèle peint par les habitants du quartier.' },
	{ src: slide3.src, alt: 'Boîte à livres en bois dans un parc', title: 'Bois & nature', desc: 'Parfaite pour les parcs et squares arborés.' },
];
---

<section class="py-16 sm:py-20 bg-gradient-to-br from-[#0B1224] via-[#0E1F38] to-[#123058] text-white relative overflow-hidden">
	<div class="absolute inset-0 grid-overlay opacity-20 pointer-events-none"></div>
	<div class="absolute -left-10 top-8 h-48 w-48 rounded-full bg-leaf/30 blur-3xl"></div>
	<div class="absolute right-6 bottom-10 h-56 w-56 rounded-full bg-cta/25 blur-3xl"></div>

	<div class="section-shell space-y-8 relative">
		<div class="max-w-3xl space-y-3" data-animate="fade-up">
			<p class="badge bg-white/10 border border-white/15 !text-white">Galerie</p>
			<h2 class="section-title !text-white">Découvrez des boîtes installées</h2>
			<p class="section-subtitle !text-white/75">
				Feuilletez les réalisations de la communauté : navigation manuelle (pas d'autoplay), fluide et accessible.
			</p>
		</div>

		<div class=" !bg-transparent border-white/10  overflow-hidden" data-animate="fade-up" data-delay="0.08">
			<div class="carousel" data-carousel>
				<div class="carousel-track" data-slides>
					{slides.map((item, index) => (
						<article class={`slide ${index === 0 ? 'is-active' : ''}`} data-index={index}>
							<img src={item.src} alt={item.alt} class="h-full w-full object-cover object-center" loading="lazy" />
							<div class="slide-overlay"></div>
							<div class="slide-caption">
								<h3 class="text-xl font-display font-semibold text-white">{item.title}</h3>
								<p class="text-sm text-white/85">{item.desc}</p>
							</div>
						</article>
					))}
				</div>

				<button class="nav-btn prev" type="button" aria-label="Précédent" data-prev>
					<span>‹</span>
				</button>
				<button class="nav-btn next" type="button" aria-label="Suivant" data-next>
					<span>›</span>
				</button>

				<div class="dots" role="tablist">
					{slides.map((_, idx) => (
						<button
							class={`dot ${idx === 0 ? 'is-active' : ''}`}
							type="button"
							role="tab"
							aria-label={`Aller à la diapositive ${idx + 1}`}
							data-dot={idx}
						></button>
					))}
				</div>
			</div>
		</div>
	</div>
</section>

<script>
	if (typeof window !== 'undefined') {
		const carousels = document.querySelectorAll('[data-carousel]');
		carousels.forEach((carousel) => {
			const slides = Array.from(carousel.querySelectorAll('[data-index]'));
			const dots = Array.from(carousel.querySelectorAll('[data-dot]'));
			const track = carousel.querySelector('[data-slides]');
			let current = 0;

			const update = () => {
				slides.forEach((slide, idx) => slide.classList.toggle('is-active', idx === current));
				dots.forEach((dot, idx) => dot.classList.toggle('is-active', idx === current));
				if (track) {
					track.style.transform = `translateX(-${current * 100}%)`;
				}
			};

			carousel.querySelector('[data-next]')?.addEventListener('click', () => {
				current = (current + 1) % slides.length;
				update();
			});

			carousel.querySelector('[data-prev]')?.addEventListener('click', () => {
				current = (current - 1 + slides.length) % slides.length;
				update();
			});

			dots.forEach((dot, idx) => {
				dot.addEventListener('click', () => {
					current = idx;
					update();
				});
			});

			update();
		});
	}
</script>

<style>
	.carousel {
		position: relative;
		overflow: hidden;
		max-width: 1040px;
		margin: 0 auto;
		padding: 0 1.5rem 1.5rem;
	}

	.carousel-track {
		display: flex;
		width: 100%;
		transition: transform 0.6s ease;
		align-items: center;
	}

	.slide {
		position: relative;
		aspect-ratio: 3 / 2;
		height: auto;
		min-height: 260px;
		max-height: 440px;
		border-radius: 18px;
		overflow: hidden;
		flex: 0 0 100%;
	}

	.slide-overlay {
		position: absolute;
		inset: 0;
		background: linear-gradient(180deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.1));
	}

	.slide-caption {
		position: absolute;
		left: 1.25rem;
		right: 1.25rem;
		bottom: 1.25rem;
		padding: 0.85rem 1.1rem;
		border-radius: 12px;
		background: rgba(14, 36, 81, 0.6);
		backdrop-filter: blur(8px);
		border: 1px solid rgba(255, 255, 255, 0.22);
		box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18);
	}

	.nav-btn {
		position: absolute;
		top: 45%;
		transform: translateY(-50%);
		height: 2.75rem;
		width: 2.75rem;
		display: grid;
		place-items: center;
		border-radius: 999px;
		background: rgba(14, 36, 81, 0.65);
		border: 1px solid rgba(255, 255, 255, 0.3);
		color: white;
		font-size: 1.6rem;
		font-weight: 700;
		backdrop-filter: blur(8px);
		transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
	}

	.nav-btn:hover {
		transform: translateY(-50%) scale(1.07);
		background: rgba(21, 198, 194, 0.7);
		box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
	}

	.nav-btn.prev {
		left: 0.25rem;
	}

	.nav-btn.next {
		right: 0.25rem;
	}

	.dots {
		display: flex;
		justify-content: center;
		gap: 0.6rem;
		padding: 0.75rem 0 0.25rem;
	}

		.dot {
			height: 10px;
			width: 10px;
			border-radius: 999px;
			background: rgba(255, 255, 255, 0.35);
			border: 1px solid rgba(255, 255, 255, 0.4);
			transition: all 0.2s ease;
		}

		.dot.is-active {
			width: 26px;
			background: linear-gradient(90deg, #15c6c2, #0e2451);
			border-color: transparent;
			box-shadow: 0 0 0 5px rgba(21, 198, 194, 0.18);
		}

	@media (max-width: 640px) {
		.nav-btn {
			height: 2.6rem;
			width: 2.6rem;
			font-size: 1.4rem;
			top: auto;
			bottom: 0.5rem;
			transform: translateY(0);
		}

		.slide-caption {
			left: 1rem;
			right: 1rem;
			bottom: 1rem;
		}
	}

	@media (prefers-reduced-motion: reduce) {
		.carousel-track {
			transition: none;
		}
	}
</style>
